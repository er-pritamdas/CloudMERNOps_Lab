
# ðŸ“˜ Section 3: Docker Images

## 3.1 What is a Docker Image?

* A **Docker Image** is a **read-only template** that contains:
  * Application code
  * Runtime (e.g., Python, Node.js)
  * Libraries & dependencies
  * Configuration files
* Images are the **blueprint** for containers.
* Containers are **running instances** of images.

---

## 3.2 Working with Images

### Listing Images

<pre class="overflow-visible!" data-start="567" data-end="697"><div class="contain-inline-size rounded-2xl relative bg-token-sidebar-surface-primary"><div class="sticky top-9"><div class="absolute end-0 bottom-0 flex h-9 items-center pe-2"><div class="bg-token-bg-elevated-secondary text-token-text-secondary flex items-center gap-4 rounded-sm px-2 font-sans text-xs"></div></div></div><div class="overflow-y-auto p-4" dir="ltr"><code class="whitespace-pre! language-bash"><span><span>docker images
docker images -a     </span><span># Show all images including intermediate</span><span>
docker images -q     </span><span># Show only image IDs</span><span>
</span></span></code></div></div></pre>

### Pulling Images

<pre class="overflow-visible!" data-start="718" data-end="823"><div class="contain-inline-size rounded-2xl relative bg-token-sidebar-surface-primary"><div class="sticky top-9"><div class="absolute end-0 bottom-0 flex h-9 items-center pe-2"><div class="bg-token-bg-elevated-secondary text-token-text-secondary flex items-center gap-4 rounded-sm px-2 font-sans text-xs"></div></div></div><div class="overflow-y-auto p-4" dir="ltr"><code class="whitespace-pre! language-bash"><span><span>docker pull ubuntu
docker pull nginx:1.25   </span><span># Pull specific tag</span><span>
docker pull ubuntu --all-tags
</span></span></code></div></div></pre>

### Removing Images

<pre class="overflow-visible!" data-start="845" data-end="977"><div class="contain-inline-size rounded-2xl relative bg-token-sidebar-surface-primary"><div class="sticky top-9"><div class="absolute end-0 bottom-0 flex h-9 items-center pe-2"><div class="bg-token-bg-elevated-secondary text-token-text-secondary flex items-center gap-4 rounded-sm px-2 font-sans text-xs"></div></div></div><div class="overflow-y-auto p-4" dir="ltr"><code class="whitespace-pre! language-bash"><span><span>docker rmi nginx:latest
docker rmi -f <image_id>     </span><span># Force remove</span><span>
docker rmi $(docker images -q)   </span><span># Remove all images</span><span>
</span></span></code></div></div></pre>

### Tagging Images

<pre class="overflow-visible!" data-start="998" data-end="1047"><div class="contain-inline-size rounded-2xl relative bg-token-sidebar-surface-primary"><div class="sticky top-9"><div class="absolute end-0 bottom-0 flex h-9 items-center pe-2"><div class="bg-token-bg-elevated-secondary text-token-text-secondary flex items-center gap-4 rounded-sm px-2 font-sans text-xs"></div></div></div><div class="overflow-y-auto p-4" dir="ltr"><code class="whitespace-pre! language-bash"><span><span>docker tag myapp:1.0 myrepo/myapp:1.0
</span></span></code></div></div></pre>

* Tags help in versioning (e.g., `nginx:1.25`, `python:3.11`).

---

## 3.3 Docker Image Layers

* Every instruction in a **Dockerfile** creates a  **new layer** .
* Layers are **cached** â†’ speeds up rebuilds.
* Example:
  <pre class="overflow-visible!" data-start="1274" data-end="1487"><div class="contain-inline-size rounded-2xl relative bg-token-sidebar-surface-primary"><div class="sticky top-9"><div class="absolute end-0 bottom-0 flex h-9 items-center pe-2"><div class="bg-token-bg-elevated-secondary text-token-text-secondary flex items-center gap-4 rounded-sm px-2 font-sans text-xs"></div></div></div><div class="overflow-y-auto p-4" dir="ltr"><code class="whitespace-pre!"><span><span>FROM</span><span> ubuntu:</span><span>20.04</span><span>       # Base layer
  RUN apt</span><span>-</span><span>get</span><span></span><span>update</span><span>      # </span><span>New</span><span> layer
  RUN apt</span><span>-</span><span>get</span><span> install </span><span>-</span><span>y python3  # </span><span>New</span><span> layer
  </span><span>COPY</span><span> app.py </span><span>/</span><span>app        # </span><span>New</span><span> layer
  CMD ["python3", "app.py"]  # </span><span>Final</span><span> layer
  </span></span></code></div></div></pre>
* Rebuild efficiency: if only `COPY app.py` changes, only that layer + below rebuilds.

---

## 3.4 Building Custom Images with Dockerfile

### What is Dockerfile?

* A **text file** containing step-by-step instructions to build an image.
* Example (`Dockerfile`):
  <pre class="overflow-visible!" data-start="1758" data-end="1918"><div class="contain-inline-size rounded-2xl relative bg-token-sidebar-surface-primary"><div class="sticky top-9"><div class="absolute end-0 bottom-0 flex h-9 items-center pe-2"><div class="bg-token-bg-elevated-secondary text-token-text-secondary flex items-center gap-4 rounded-sm px-2 font-sans text-xs"></div></div></div><div class="overflow-y-auto p-4" dir="ltr"><code class="whitespace-pre! language-dockerfile"><span>FROM python:3.11-slim
  WORKDIR /app
  COPY requirements.txt .
  RUN pip install -r requirements.txt
  COPY . .
  CMD ["python", "app.py"]
  </span></code></div></div></pre>

### Building Image

<pre class="overflow-visible!" data-start="1939" data-end="1978"><div class="contain-inline-size rounded-2xl relative bg-token-sidebar-surface-primary"><div class="sticky top-9"><div class="absolute end-0 bottom-0 flex h-9 items-center pe-2"><div class="bg-token-bg-elevated-secondary text-token-text-secondary flex items-center gap-4 rounded-sm px-2 font-sans text-xs"></div></div></div><div class="overflow-y-auto p-4" dir="ltr"><code class="whitespace-pre! language-bash"><span><span>docker build -t myapp:1.0 .
</span></span></code></div></div></pre>

* `-t` = tag name
* `.` = current directory where Dockerfile is

---

## 3.5 Common Dockerfile Instructions

| Instruction    | Description                                              | Example                                       |
| -------------- | -------------------------------------------------------- | --------------------------------------------- |
| `FROM`       | Base image                                               | `FROM ubuntu:20.04`                         |
| `RUN`        | Execute commands while building image                    | `RUN apt-get install -y python3`            |
| `COPY`       | Copy files from host to image                            | `COPY app.py /app/`                         |
| `ADD`        | Like COPY but also supports remote URLs & tar extraction | `ADD https://example.com/file.tar.gz /app/` |
| `WORKDIR`    | Set working directory                                    | `WORKDIR /app`                              |
| `CMD`        | Default command when container starts                    | `CMD ["python3", "app.py"]`                 |
| `ENTRYPOINT` | Main executable (cannot be overridden easily)            | `ENTRYPOINT ["python3"]`                    |
| `EXPOSE`     | Document containerâ€™s listening port                     | `EXPOSE 8080`                               |
| `ENV`        | Set environment variables                                | `ENV APP_ENV=prod`                          |

---

## 3.6 CMD vs ENTRYPOINT

* **CMD** â†’ Default command but can be overridden.

  <pre class="overflow-visible!" data-start="2923" data-end="2979"><div class="contain-inline-size rounded-2xl relative bg-token-sidebar-surface-primary"><div class="sticky top-9"><div class="absolute end-0 bottom-0 flex h-9 items-center pe-2"><div class="bg-token-bg-elevated-secondary text-token-text-secondary flex items-center gap-4 rounded-sm px-2 font-sans text-xs"></div></div></div><div class="overflow-y-auto p-4" dir="ltr"><code class="whitespace-pre! language-dockerfile"><span>CMD ["nginx", "-g", "daemon off;"]
  </span></code></div></div></pre>

  Run:

  <pre class="overflow-visible!" data-start="2989" data-end="3054"><div class="contain-inline-size rounded-2xl relative bg-token-sidebar-surface-primary"><div class="sticky top-9"><div class="absolute end-0 bottom-0 flex h-9 items-center pe-2"><div class="bg-token-bg-elevated-secondary text-token-text-secondary flex items-center gap-4 rounded-sm px-2 font-sans text-xs"></div></div></div><div class="overflow-y-auto p-4" dir="ltr"><code class="whitespace-pre! language-bash"><span><span>docker run myimage </span><span>echo</span><span></span><span>"hello"</span><span></span><span># Overrides CMD</span><span>
  </span></span></code></div></div></pre>
* **ENTRYPOINT** â†’ Command is fixed, arguments are appended.

  <pre class="overflow-visible!" data-start="3121" data-end="3178"><div class="contain-inline-size rounded-2xl relative bg-token-sidebar-surface-primary"><div class="sticky top-9"><div class="absolute end-0 bottom-0 flex h-9 items-center pe-2"><div class="bg-token-bg-elevated-secondary text-token-text-secondary flex items-center gap-4 rounded-sm px-2 font-sans text-xs"></div></div></div><div class="overflow-y-auto p-4" dir="ltr"><code class="whitespace-pre! language-dockerfile"><span>ENTRYPOINT ["echo"]
  CMD ["hello"]
  </span></code></div></div></pre>

  Run:

  <pre class="overflow-visible!" data-start="3188" data-end="3241"><div class="contain-inline-size rounded-2xl relative bg-token-sidebar-surface-primary"><div class="sticky top-9"><div class="absolute end-0 bottom-0 flex h-9 items-center pe-2"><div class="bg-token-bg-elevated-secondary text-token-text-secondary flex items-center gap-4 rounded-sm px-2 font-sans text-xs"></div></div></div><div class="overflow-y-auto p-4" dir="ltr"><code class="whitespace-pre! language-bash"><span><span>docker run myimage hi   </span><span># Output â†’ hi</span><span>
  </span></span></code></div></div></pre>

---

## 3.7 Image Optimization

* Use **small base images** (e.g., `alpine` instead of `ubuntu`).
* Combine RUN commands with `&&` to reduce layers.
* Use `.dockerignore` to avoid copying unnecessary files.
* Use **multi-stage builds** for production.

**Multi-stage example:**

<pre class="overflow-visible!" data-start="3526" data-end="3738"><div class="contain-inline-size rounded-2xl relative bg-token-sidebar-surface-primary"><div class="sticky top-9"><div class="absolute end-0 bottom-0 flex h-9 items-center pe-2"><div class="bg-token-bg-elevated-secondary text-token-text-secondary flex items-center gap-4 rounded-sm px-2 font-sans text-xs"></div></div></div><div class="overflow-y-auto p-4" dir="ltr"><code class="whitespace-pre! language-dockerfile"><span># Stage 1: Build
FROM golang:1.20 as builder
WORKDIR /app
COPY . .
RUN go build -o myapp

# Stage 2: Production
FROM alpine:3.17
COPY --from=builder /app/myapp /usr/local/bin/myapp
CMD ["myapp"]
</span></code></div></div></pre>

â†’ Final image only has compiled binary, no Go toolchain.

---

## 3.8 Saving & Sharing Images

### Save Image to File

<pre class="overflow-visible!" data-start="3857" data-end="3903"><div class="contain-inline-size rounded-2xl relative bg-token-sidebar-surface-primary"><div class="sticky top-9"><div class="absolute end-0 bottom-0 flex h-9 items-center pe-2"><div class="bg-token-bg-elevated-secondary text-token-text-secondary flex items-center gap-4 rounded-sm px-2 font-sans text-xs"></div></div></div><div class="overflow-y-auto p-4" dir="ltr"><code class="whitespace-pre! language-bash"><span><span>docker save -o myapp.tar myapp:1.0
</span></span></code></div></div></pre>

### Load Image from File

<pre class="overflow-visible!" data-start="3930" data-end="3966"><div class="contain-inline-size rounded-2xl relative bg-token-sidebar-surface-primary"><div class="sticky top-9"><div class="absolute end-0 bottom-0 flex h-9 items-center pe-2"><div class="bg-token-bg-elevated-secondary text-token-text-secondary flex items-center gap-4 rounded-sm px-2 font-sans text-xs"></div></div></div><div class="overflow-y-auto p-4" dir="ltr"><code class="whitespace-pre! language-bash"><span><span>docker load -i myapp.tar
</span></span></code></div></div></pre>

### Push to Docker Hub

<pre class="overflow-visible!" data-start="3991" data-end="4086"><div class="contain-inline-size rounded-2xl relative bg-token-sidebar-surface-primary"><div class="sticky top-9"><div class="absolute end-0 bottom-0 flex h-9 items-center pe-2"><div class="bg-token-bg-elevated-secondary text-token-text-secondary flex items-center gap-4 rounded-sm px-2 font-sans text-xs"></div></div></div><div class="overflow-y-auto p-4" dir="ltr"><code class="whitespace-pre! language-bash"><span><span>docker login
docker tag myapp:1.0 username/myapp:1.0
docker push username/myapp:1.0
</span></span></code></div></div></pre>

---

âœ… **Summary of Section 3**

* Images = blueprints for containers.
* Built using **Dockerfile** instructions.
* Layers & caching improve efficiency.
* Best practices: small images, multi-stage builds.
* Images can be saved, loaded, pushed to registries.

---

ðŸ‘‰ Do you want me to now make a **big comman**
