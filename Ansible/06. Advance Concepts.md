# ðŸ“˜ **Section 5: Advanced Concepts in Ansible**

---

## ðŸ”¹ 5.1 **Dynamic Inventory**

* Static inventory is fine for a few servers.
* In real environments (AWS, Azure, GCP, Kubernetes), hosts change dynamically.
* **Dynamic inventory** pulls host data directly from cloud APIs.

**Example: AWS EC2 Dynamic Inventory (plugin):**

`aws_ec2.yml`

```yaml
plugin: aws_ec2
regions:
  - ap-south-1
keyed_groups:
  - key: tags.Name
    prefix: tag
filters:
  instance-state-name: running
```

Run it:

```bash
ansible-inventory -i aws_ec2.yml --list
```

ðŸ‘‰ **Interview Q:** *Whatâ€™s the difference between static and dynamic inventory?*

* Static = fixed list of hosts in file.
* Dynamic = generated from external sources (cloud APIs, DB, etc.).

---

## ðŸ”¹ 5.2 **Custom Modules**

* If built-in modules donâ€™t cover a use case, you can write your own (Python, PowerShell, etc.).

**Example: Simple Python module**

```python
#!/usr/bin/python

from ansible.module_utils.basic import AnsibleModule

def main():
    module = AnsibleModule(argument_spec=dict(name=dict(required=True)))
    response = {"message": "Hello " + module.params['name']}
    module.exit_json(changed=False, meta=response)

if __name__ == '__main__':
    main()
```

Use in playbook:

```yaml
- hosts: all
  tasks:
    - name: Run custom hello module
      hello:
        name: Pritam
```

ðŸ‘‰ **Interview Q:** *Have you written a custom module? Why?*

* When required functionality is missing from built-ins.

---

## ðŸ”¹ 5.3 **Plugins**

Plugins extend Ansibleâ€™s behavior.

Types:  **callback, connection, lookup, filter** .

**Example: Callback plugin (log all output to JSON):**

```bash
export ANSIBLE_STDOUT_CALLBACK=json
```

ðŸ‘‰ **Interview Q:** *Difference between modules and plugins?*

* **Module** = does work on nodes.
* **Plugin** = extends Ansible core engine behavior.

---

## ðŸ”¹ 5.4 **Strategies**

Define  **how tasks run across multiple hosts** .

* **Linear (default):**

  Runs task 1 on all hosts â†’ then task 2 on all hosts â†’ etc.
* **Free strategy:**

  Each host runs tasks independently as fast as possible.

```yaml
- hosts: all
  strategy: free
  tasks:
    - name: Install package
      yum:
        name: nginx
        state: present
```

ðŸ‘‰ **Interview Q:** *When would you use `free` strategy?*

* When tasks are independent (faster execution).

---

## ðŸ”¹ 5.5 **Delegation & Local Actions**

Sometimes you want tasks to run **on a different host** than the target.

**Delegate to another host:**

```yaml
- hosts: web
  tasks:
    - name: Run task on DB server
      command: echo "DB Update Trigger"
      delegate_to: db01
```

**Run locally:**

```yaml
- hosts: web
  tasks:
    - name: Create file locally
      local_action: command touch /tmp/localfile
```

ðŸ‘‰ **Interview Q:** *What is `delegate_to` used for?*

* Running a task on another host (common in load balancers, DB migrations).

---

## ðŸ”¹ 5.6 **Blocks, Rescue & Always**

Blocks group multiple tasks and handle failures.

```yaml
- hosts: all
  tasks:
    - block:
        - name: Install nginx
          yum:
            name: nginx
            state: present

        - name: Start nginx
          service:
            name: nginx
            state: started

      rescue:
        - name: Print failure message
          debug:
            msg: "Installation failed!"

      always:
        - name: Always run cleanup
          file:
            path: /tmp/tempfile
            state: absent
```

ðŸ‘‰ **Interview Q:** *Why use `block` in Ansible?*

* To group tasks and handle errors with **rescue** and **always** sections.

---

# âœ… **Interview Checkpoints (Section 5)**

* Explain **dynamic inventory** (AWS/GCP/Azure use cases).
* Difference between  **modules vs plugins** .
* When do you use  **custom modules** ?
* Strategies â†’  **linear vs free** .
* `delegate_to` vs `local_action`.
* `block`, `rescue`, `always` for error handling.

---
