# ğŸ“˜ **Section 3: Core Concepts**

---

## ğŸ”¹ 3.1 **Inventory**

### What is Inventory?

* A file that tells Ansible  **which hosts/servers to manage** .
* Can be **static** or  **dynamic** .

### Static Inventory

`hosts.ini`

```ini
[web]
192.168.1.10
192.168.1.11

[db]
192.168.1.20 ansible_user=ubuntu ansible_ssh_private_key_file=~/.ssh/id_rsa
```

### Dynamic Inventory

* Pulls host info from cloud providers (AWS, Azure, GCP).
* Example (AWS):

```yaml
plugin: aws_ec2
regions:
  - ap-south-1
keyed_groups:
  - key: tags.Name
```

**Check inventory:**

```bash
ansible-inventory -i hosts.ini --list
ansible-inventory -i inventory_aws_ec2.yml --graph
```

ğŸ‘‰ **Interview Q:** What is the difference between **static** and **dynamic** inventory?

---

## ğŸ”¹ 3.2 **Modules**

* Small programs that Ansible runs on nodes.
* Over **3000+ modules** available.
* Common modules:
  * `ping` â†’ Test connectivity
  * `command` â†’ Run commands
  * `shell` â†’ Run shell commands
  * `yum/apt` â†’ Install packages
  * `service` â†’ Manage services
  * `file` â†’ Manage files/directories
  * `copy` â†’ Copy files
  * `template` â†’ Copy files with Jinja2 templating
  * `user` â†’ Manage users
  * `lineinfile` â†’ Edit config files line by line

**Example:**

```bash
ansible all -m ping
ansible web -m yum -a "name=httpd state=present"
```

ğŸ‘‰ **Interview Q:** Whatâ€™s the difference between `command` and `shell` modules?

* `command` â†’ does **not** process shell features (`|`, `>`, `&&`).
* `shell` â†’ runs through the shell, supports pipes, redirection, variables.

---

## ğŸ”¹ 3.3 **Playbooks**

* YAML files that  **define automation tasks** .
* More powerful than ad-hoc commands.
* Run using:

```bash
ansible-playbook site.yml
```

**Example Playbook:**

```yaml
- name: Install Apache Web Server
  hosts: web
  become: yes
  tasks:
    - name: Install Apache
      yum:
        name: httpd
        state: present

    - name: Start Apache
      service:
        name: httpd
        state: started
        enabled: yes
```

ğŸ‘‰ **Interview Q:** What is  **idempotency** ?

* Applying the same playbook multiple times results in the same final state without unnecessary changes.

---

## ğŸ”¹ 3.4 **Variables**

* Variables make playbooks  **dynamic** .

**Define variables in playbook:**

```yaml
- hosts: web
  vars:
    pkg: nginx
  tasks:
    - name: Install package
      yum:
        name: "{{ pkg }}"
        state: present
```

**Host/Group Variables:**

```yaml
# group_vars/web.yml
pkg: httpd
```

**Extra Variables (highest priority):**

```bash
ansible-playbook install.yml -e "pkg=nginx"
```

ğŸ‘‰ **Interview Q:** What are different ways to define variables in Ansible?

* Playbook vars, `group_vars/`, `host_vars/`, `vars_files`, extra-vars, facts.

---

## ğŸ”¹ 3.5 **Conditionals**

* Use `when` to run tasks conditionally.

<details>
<summary>Example with <code>when</code>:</summary>

```yaml
- hosts: all
  tasks:
    - name: Install Apache on CentOS
      yum:
        name: httpd
        state: present
      when: ansible_facts['os_family'] == "RedHat"
```

</details>

ğŸ‘‰ **Interview Q:** How do you run a task only if the OS is Ubuntu?

Use `when: ansible_facts['os_family'] == "Debian"`.

---

## ğŸ”¹ 3.6 **Loops**

* Run tasks multiple times with lists.

**Example with `loop`:**

```yaml
- hosts: all
  tasks:
    - name: Create multiple users
      user:
        name: "{{ item }}"
        state: present
      loop:
        - user1
        - user2
        - user3
```

**Example with `with_items`:**

```yaml
- name: Install multiple packages
  yum:
    name: "{{ item }}"
    state: present
  with_items:
    - git
    - wget
    - curl
```

ğŸ‘‰ **Interview Q:** Difference between `with_items` and `loop`?

* `loop` is the  **new standard** ; `with_items` is older but still supported.

---

## ğŸ”¹ 3.7 **Handlers**

* Special tasks that run  **only when notified** .
* Useful for restarting services after a config change.

```yaml
- hosts: web
  tasks:
    - name: Copy Apache config
      copy:
        src: httpd.conf
        dest: /etc/httpd/conf/httpd.conf
      notify: Restart Apache

  handlers:
    - name: Restart Apache
      service:
        name: httpd
        state: restarted
```

ğŸ‘‰ **Interview Q:** When do handlers run?

* At the  **end of the playbook execution** , unless forced with `--force-handlers`.

---

## ğŸ”¹ 3.8 **Facts**

* Facts = system information collected by Ansible.
* Gathered at the beginning of a playbook (unless disabled).

**Example:**

```yaml
- hosts: all
  tasks:
    - debug:
        msg: "My hostname is {{ ansible_hostname }} and IP is {{ ansible_default_ipv4.address }}"
```

**Disable fact gathering:**

```yaml
- hosts: all
  gather_facts: no
```




## ğŸ“‚ 1. Default Inventory Location

By default, Ansible looks at:

```text
/etc/ansible/hosts
```

But you can also specify your own inventory file with:

```bash
ansible -i inventory.ini all -m ping
```

---

## ğŸ“Œ 2. Creating Groups in Inventory

You can use **INI format** or  **YAML format** .

---

### **INI Format (most common)**

```ini
[webservers]
192.168.1.10
192.168.1.11 ansible_user=ubuntu ansible_port=2222

[dbservers]
192.168.1.20

[loadbalancers]
lb1.example.com
```

â¡ï¸ Here:

* Group **webservers** has 2 hosts
* Group **dbservers** has 1 host
* Group **loadbalancers** has 1 host

---

### **YAML Format (modern style)**

```yaml
all:
  children:
    webservers:
      hosts:
        192.168.1.10:
        192.168.1.11:
          ansible_user: ubuntu
          ansible_port: 2222
    dbservers:
      hosts:
        192.168.1.20:
    loadbalancers:
      hosts:
        lb1.example.com:
```

---

## ğŸ“Œ 3. Nested Groups (Group of Groups)

Sometimes you want a  **higher-level group** :

```ini
[frontend]
192.168.1.10
192.168.1.11

[backend]
192.168.1.20

[production:children]
frontend
backend
```

â¡ï¸ `production` is a parent group that includes  **frontend + backend** .

---

## ğŸ“Œ 4. Using Groups in Playbooks

```yaml
- name: Deploy web servers
  hosts: webservers
  tasks:
    - name: Install Apache
      apt:
        name: apache2
        state: present
```

If you run:

```bash
ansible-playbook -i inventory.ini site.yml --limit webservers
```

ğŸ‘‰ This will only target **webservers** group.

---

## ğŸ“Œ 5. Special Groups

* **all** â†’ includes every host in inventory
* **ungrouped** â†’ includes hosts not in any group

---

âš¡ So basically:

* You define **groups** in inventory (`INI` or `YAML`).
* You run playbooks targeting  **groups** .
* You can combine, nest, or limit groups during execution.

---

# âœ… **Interview Checkpoints (Section 3)**

* Difference between  **ad-hoc vs playbook** .
* Explain  **idempotency** .
* `command` vs `shell`.
* How to use **variables** (priority order).
* Example of  **loops** ,  **when conditionals** .
* Handlers (why they run at the end).
* How to get system info using  **facts** .

---
