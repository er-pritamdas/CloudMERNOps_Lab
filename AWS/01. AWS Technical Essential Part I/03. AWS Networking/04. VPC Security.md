## ğŸ›¡ï¸ Amazon VPC Security

AWS security is **top priority** , and VPC security offers two main layers:

1. **Network ACLs** (subnet-level, stateless)
2. **Security Groups** (instance-level, stateful)

---

### ğŸ”ƒ 1. **Network ACLs (NACLs)** â€“ Subnet-Level Firewall

#### ğŸ“Œ What is a Network ACL?

- Acts like a **firewall at the subnet level** .
- Allows or denies **specific inbound and outbound traffic** .
- **Stateless** : responses must be explicitly allowed in both directions.

![Network ACLs](../../Visuals/NACLs.png)

#### ğŸ”§ Default Network ACL

- **Inbound** : ALLOW all â†’ rule `100`
- **Outbound** : ALLOW all â†’ rule `100`
- Catch-all `*` rule: DENY (implicit fallback)

â¡ï¸ Default ACLs are **open** to allow free communication â€” a good starting point.

#### ğŸ” Custom Network ACL Example:

**Inbound Rules**

| Rule | Protocol | Port | Source IP    | Action | Comment          |
| ---- | -------- | ---- | ------------ | ------ | ---------------- |
| 100  | TCP      | 443  | 0.0.0.0/0    | ALLOW  | HTTPS traffic    |
| 130  | TCP      | 3389 | 192.0.2.0/24 | ALLOW  | RDP from home IP |
| \*   | All      | All  | All          | DENY   | Block all others |

**Outbound Rules**

| Rule | Protocol | Port Range  | Destination IP | Action | Comment          |
| ---- | -------- | ----------- | -------------- | ------ | ---------------- |
| 120  | TCP      | 1025â€“65535 | 0.0.0.0/0      | ALLOW  | Response traffic |
| \*   | All      | All         | 0.0.0.0/0      | DENY   | Catch-all deny   |

> ğŸ“Œ **Ephemeral Ports (1025â€“65535)** must be allowed in outbound rules to respond to incoming HTTPS.

#### ğŸš¨ Key Notes:

- NACLs are **stateless** â both **inbound and outbound** rules are required for bidirectional traffic.
- You can use NACLs to **add another layer of defense** (e.g., block suspicious IPs).
- Ideal for **broad subnet-level rules** (e.g., DMZ-style filtering).

---

### ğŸ§± 2. **Security Groups (SGs)** â€“ Instance-Level Firewall

#### ğŸ“Œ What is a Security Group?

- Acts like a **virtual firewall for EC2 instances** .
- **Stateful** : if a request goes out, the response is automatically allowed back in.
- You only need to define **inbound rules** for allowed incoming connections.
  ![Network ACLs](../../Visuals/Security%20Groups.jpg)

#### ğŸ”§ Default Behavior:

- **Inbound** : âŒ Blocked (no access by default)
- **Outbound** : âœ… Allowed (full egress)

> âœ… Responses to **outgoing connections** are automatically allowed due to statefulness.

#### ğŸ“¥ Example Inbound Rules:

| Type  | Protocol  | Port | Source    | Purpose     |
| ----- | --------- | ---- | --------- | ----------- |
| HTTP  | TCP (4/6) | 80   | 0.0.0.0/0 | Web traffic |
| HTTPS | TCP (4/6) | 443  | 0.0.0.0/0 | Secure web  |

#### ğŸ§± Use Case: 3-Tier Architecture

![Network ACLs](../../Visuals/SGs.jpg)

| Layer    | Allowed Inbound     | Notes                        |
| -------- | ------------------- | ---------------------------- |
| Web Tier | HTTPS from Internet | Public-facing EC2            |
| App Tier | HTTP from Web Tier  | Internal business logic      |
| DB Tier  | MySQL from App Tier | Secure access to RDS backend |

> ğŸ“Œ Use **security groups to segregate tiers** (like VLANs but virtual) and allow specific app-level communication.

---

### ğŸ§  Cloud Engineer Insights

ğŸ”¹ **When to Use What**

| Layer          | Use Case                     | Key Feature |
| -------------- | ---------------------------- | ----------- |
| NACL           | Subnet-level filtering       | Stateless   |
| Security Group | EC2 instance-level filtering | Stateful    |

ğŸ”¹ **Best Practices**

- Start with **default NACL** , then customize only if needed.
- Always define **least privilege rules** .
- Combine **NACLs + SGs** for defense-in-depth.
- Regularly audit rules and **document all open ports** .
- Use **CIDR-based restrictions** for tighter access control (e.g., home IPs, office networks).

---

### ğŸ“š Resources

- [ğŸ“ AWS: Control Traffic to Subnets Using Network ACLs](https://docs.aws.amazon.com/vpc/latest/userguide/vpc-network-acls.html)
- [ğŸ“ AWS: Control Traffic to Resources Using Security Groups](https://docs.aws.amazon.com/vpc/latest/userguide/VPC_SecurityGroups.html)

---
